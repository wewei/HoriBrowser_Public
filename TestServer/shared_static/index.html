<html>
	<head>
        <script src="dryObject.js"></script>
	</head>
	<body>
		<h1>It works</h1>
        <button onclick="location.reload()">Reload</button><br>
		<input type="text" id="textIn"></input>
		<button onclick="showBaidu()">Baidu</button></br>
		<button onclick="testGetProperty(10)">test getProperty</button></br>
		<button onclick="testWrite()">Write</button>
		<button onclick="testWriteJSON()">Write JSON</button>
		<button onclick="testRead()">Read</button></br>
		<script type="text/javascript">

        var PATH = "/User/foobar";
        var navCtrl = null;

        function testWriteJSON()
        {
            var text = document.getElementById("textIn").value;
            $H(PATH).write(JSON.parse(text), function() { alert("write JSON OK"); });
        }
        function testWrite()
        {
            var text = document.getElementById("textIn").value;
            $H(PATH).write(text, function() { alert("write OK"); });
        }

        function testRead()
        {
            $H(PATH).read(function(args) { alert(args.returnValue); });
        }

        function showBaidu()
        {
			function loadAndPush(webViewCtrl) {
				function unlinkWebViewCtrl() {
					webViewCtrl.unlink();
				}

				function pushControler() {
					navCtrl.pushViewController(webViewCtrl)
						.onSuccess(unlinkWebViewCtrl)
						.onFailure(unlinkWebViewCtrl);
				}

				function onStartLoading() {
					alert("start load.");
					return "hello";
				}

				function loadPage(url) {
					webViewCtrl.loadURL(url, onStartLoading)
						.onSuccess(pushControler)
						.onFailure(unlinkWebViewCtrl);
				}

				loadPage("http://www.baidu.com/");
			}

			$H.bridgedClass("HBWebViewController").NEW()
				.onSuccess(loadAndPush);
        }

        function testGetProperty(n)
        {
            if (n > 0) {
                $H.webViewController.getProperty(
                    "navigationItemTitle",
                    function (args) {
                        document.body.innerHTML += "<p>" + args.returnValue + "</p>\n";
                        testGetProperty(n - 1);
                    }
                );
            }
        }

        function setRootViewController(viewController)
        {
            $H.rootViewController.invoke(
                "presentViewController",
                {
                    "viewController": viewController,
                    "animated": 1,
                }
            );
        }

        function $H_main() {
            $H.bridgedClass("HBNavigationController").GLOBAL_NEW(
				"/User/navigationController",
				{ "rootViewController" : $H.webViewController }
			).onSuccess(function (_navCtrl) {
				navCtrl = _navCtrl;
				setRootViewController(navCtrl);
			}).onFailure(function (exception) {
				console.log(exception);
				navCtrl = $H("/User/navigationController");
            });
            $H.webViewController.setProperty("navigationItemTitle", "Welcome");
        }

		</script>
	</body>
</html>
