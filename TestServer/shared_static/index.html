<html>
	<head>
        <script src="dryObject.js"></script>
	</head>
	<body>
		<h1>It works</h1>
        <button onclick="location.reload()">Reload</button><br>
		<input type="text" id="textIn"></input>
		<button onclick="showBaidu()">Baidu</button></br>
		<button onclick="testGetProperty(10)">test getProperty</button></br>
		<button onclick="testWrite()">Write</button>
		<button onclick="testWriteJSON()">Write JSON</button>
		<button onclick="testRead()">Read</button></br>
		<script type="text/javascript">

        var PATH = "/User/foobar";
        var navCtrl = null;

        function testWriteJSON()
        {
            var text = document.getElementById("textIn").value;
            $H(PATH).write(JSON.parse(text), function() { alert("write JSON OK"); });
        }
        function testWrite()
        {
            var text = document.getElementById("textIn").value;
            $H(PATH).write(text, function() { alert("write OK"); });
        }

        function testRead()
        {
            $H(PATH).read(function(args) { alert(args.returnValue); });
        }

        function showBaidu()
        {
			$H.bridgedClass("WebViewController").NEW(null).onSuccess(function(webViewCtrl) {
				function unlinkWebViewCtrl() {
					webViewCtrl.unlink();
				}
				function pushControler() {
					navCtrl.invoke(
						"pushViewController",
						{ "viewController" : webViewCtrl }
					).onSuccess(
						unlinkWebViewCtrl
					).onFailure(
						unlinkWebViewCtrl
					);
				}
				function loadPage(url) {
					webViewCtrl.invoke(
						"loadURL",
						{
							"url" : url,
							"onStartLoading" :
								function () {
									alert("start load.");
									return "hello";
								},
						}
					).onSuccess(
						pushControler
					).onFailure(
						unlinkWebViewCtrl
					);
				}
				loadPage("http://www.baidu.com/");
			});
        }

        function testGetProperty(n)
        {
            if (n > 0) {
                $H.webViewController.getProperty(
                    "navigationItemTitle",
                    function (args) {
                        document.body.innerHTML += "<p>" + args.returnValue + "</p>\n";
                        testGetProperty(n - 1);
                    }
                );
            }
        }

        function setRootViewController(viewController)
        {
            $H.rootViewController.invoke(
                "presentViewController",
                {
                    "viewController": viewController,
                    "animated": 1,
                }
            );
        }

        function $H_main() {
            $H.bridgedClass("NavigationController").GLOBAL_NEW(
				"/User/NavigationController",
				{ "rootViewController" : $H.webViewController }
			).onSuccess(function (_navCtrl) {
				navCtrl = _navCtrl;
				setRootViewController(navCtrl);
			}).onFailure(function (exception) {
				console.log(exception);
				navCtrl = $H("/User/NavigationController");
            });
            $H.webViewController.setProperty("navigationItemTitle", "Welcome");
        }

		</script>
	</body>
</html>
